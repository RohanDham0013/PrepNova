<!-- Copilot instructions for PrepNova project -->
# PrepNova — AI coding instructions for automated agents

This file gives focused, actionable guidance to an AI code assistant working in this repository. Keep suggestions concrete and make edits only when you can run or safely reason about the change.

- Project entry points: `index.tsx` and `App.tsx` (UI), `services/geminiService.ts` (AI backend integration). Update these files together when changing data flow or schemas.
- Dev commands: use `npm install` then `npm run dev` to start. Build with `npm run build`. See `package.json` for scripts.

Important project specifics
- AI integration: `services/geminiService.ts` uses `@google/genai` and expects an environment API key. The code checks `process.env.API_KEY`. Vite maps `GEMINI_API_KEY` into `process.env.API_KEY` in `vite.config.ts` (`define`), and README instructs setting `GEMINI_API_KEY` in `.env.local`.
- Strict JSON contract: the service prompts require the model to return strict JSON arrays/objects (no extra text). Code parses `response.text` and JSON.parse; if model output deviates, the app throws. When editing prompts, preserve the "only JSON" constraint and the schema in `generateContent` config.
- Time formatting mismatch to watch for: UI `FileUpload` and `App.tsx` use an HTML `type="time"` input (value like `19:00`) but the Gemini prompt requires a 12-hour format (e.g., `7:00 PM`). If changing prompt or passing `preferredTime` to the AI, convert from 24-hour `HH:MM` to `h:mm AM/PM` before sending.
- Date inference rules: the prompt in `geminiService.ts` instructs the model to assume the 2025–2026 academic year and how to infer missing years. Preserve or update these rules intentionally and document any change.
- File input types: `components/FileUpload.tsx` accepts `.pdf` and `.docx`. Maintain this when changing the file parsing flow.

State & flow patterns
- The UI is a simple local React state machine in `App.tsx` using `step: 'upload' | 'processing' | 'results' | 'success'`. When adding features that change navigation or state, update `renderStep()` and all components consuming `studyPlan`.
- Study plan shape: generated by `analyzeSyllabus` and refined by `adjustStudyPlan`. When changing properties of `StudySession` or adjustment response, update `types.ts`, `ResultsDisplay`, and calendar sync code in `App.tsx`.

Auth & calendar sync
- Google sign-in is implemented in `App.tsx` (GSI token client). Calendar sync uses `fetch` to list/delete/create events if `isSignedIn && accessToken`. When modifying calendar logic, preserve the safe-fail behavior: failures are logged and the UI still updates the plan (do not block UI updates on calendar errors).

Editing prompts or schema
- If you change prompt text or the expected schema in `services/geminiService.ts`:
  - Update the TypeScript schema in `generateContent` config (Type.ARRAY / Type.OBJECT) to match the new expected fields.
  - Update `App.tsx` (parsing, `sessionId` generation) and `ResultsDisplay` (rendering fields).
  - Add unit / integration tests or a small script that feeds a sample syllabus file to `analyzeSyllabus` (or mock the AI) and asserts JSON parsing succeeds.

Quick examples
- Where to change the model prompt: `services/geminiService.ts` — the prompt contains spacing, date rules, and output constraints. Keep the "Output Constraints: only JSON" clause.
- Where to fix time conversion: before calling `analyzeSyllabus` in `App.tsx` convert `preferredTime` from `HH:MM` to `h:mm AM/PM` (example: `19:00` -> `7:00 PM`).

Developer workflow notes
- Local env: set `GEMINI_API_KEY` in `.env.local` (README references this). Vite exposes it as `process.env.API_KEY` via `vite.config.ts`.
- Dependencies: the app uses `@google/genai` (see `package.json`). When bumping versions, validate the `generateContent` API shape.

When in doubt
- Search for code locations mentioned above before applying changes. Prefer editing the prompt and local conversion logic rather than changing downstream parsing logic which assumes strict JSON.
- Keep changes minimal and test locally with `npm run dev`. If you cannot run the app, leave clear TODO comments in the file you edit explaining what must be validated at runtime.

If you update this document
- Preserve any useful historical content and merge it into this shorter guide. Mention the files you changed and a one-line reason.

— End of instructions —
